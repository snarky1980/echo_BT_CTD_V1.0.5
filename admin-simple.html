<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Email Assistant – Console simple</title>
  <!-- meta used for GitHub repo autodetection for JSON publish -->
  <meta name="gh-repo" content="snarky1980/echo-bt-ctd" />
    <meta name="robots" content="noindex, nofollow" />
    <link rel="icon" type="image/svg+xml" href="/favicon-e.svg" />
    <style>
      :root { --border:#e2e8f0; --panel:#fff; --muted:#64748b; --ink:#0f172a; --teal:#059669; }
      *{box-sizing:border-box}
      body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f8fafc;color:var(--ink)}
      .topbar{position:sticky;top:0;z-index:10;display:flex;gap:8px;align-items:center;padding:10px;border-bottom:1px solid var(--border);background:rgba(255,255,255,.9);backdrop-filter:blur(6px)}
      .topbar .brand{font-weight:800}
      .topbar .spacer{flex:1}
      .btn{border:1px solid var(--border);background:#fff;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
      .btn.primary{background:var(--teal);border-color:var(--teal);color:#fff}
  .btn.danger{background:#fef2f2;border-color:#fecaca;color:#991b1b}
        .btn.info{background:#0ea5e9;border-color:#0ea5e9;color:#fff}
        .btn.indigo{background:#6366f1;border-color:#6366f1;color:#fff}
        .btn.warning{background:#f59e0b;border-color:#fbbf24;color:#1f2937}
        .btn.neutral{background:#fff;color:#0f172a}
        .topbar .group{display:flex;gap:8px;padding:4px;border:1px solid var(--border);border-radius:12px;background:#f1f5f9}
        .dropdown{position:relative}
        .menu{display:none;position:absolute;right:0;top:44px;background:#fff;border:1px solid var(--border);border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,.12);min-width:220px;z-index:20}
        .menu .item{display:block;width:100%;text-align:left;border:0;background:transparent;padding:8px 12px}
        .menu .item + .item{border-top:1px solid var(--border)}
        /* Badge + import mode */
        #updated-badge{display:none;margin-left:6px;padding:4px 8px;font-size:11px;font-weight:700;border:1px solid #bae6fd;background:#ecfeff;color:#0e7490;border-radius:8px}
        #import-mode{margin-left:8px;border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;font-weight:700;font-size:12px}
        /* Utilities */
        .span-2{grid-column:1 / span 2}
        /* Modal styling */
        #modal-category-colors{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:1000;align-items:center;justify-content:center}
        .modal-panel{background:#fff;border:1px solid var(--border);border-radius:14px;width:min(720px,92vw);max-height:85vh;display:flex;flex-direction:column}
        .modal-header{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
        .modal-close{border:0;background:transparent;font-size:18px;cursor:pointer}
        .modal-body{padding:14px;overflow:auto;flex:1}
        .modal-note{margin:0 0 12px;color:var(--muted);font-size:13px}
        #category-colors-list{display:grid;gap:10px}
        .modal-footer{padding:12px;border-top:1px solid var(--border);display:flex;gap:8px;justify-content:flex-end}
      .seg{display:inline-flex;gap:4px;border:1px solid var(--border);border-radius:10px;padding:4px;background:#f1f5f9}
      .seg button{border:0;background:transparent;padding:6px 10px;border-radius:8px;font-weight:800;color:var(--muted);cursor:pointer}
      .seg button[aria-pressed="true"]{background:#fff;color:var(--ink)}
      .frame{display:grid;grid-template-columns:320px 1fr;gap:12px;padding:12px}
      .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px}
      .panel .head{padding:10px 12px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
      .panel .body{padding:12px}
      .search{display:flex;gap:8px}
      .search input{flex:1;border:1px solid var(--border);padding:8px 10px;border-radius:10px}
      .list{display:grid;gap:8px;max-height:calc(100vh - 230px);overflow:auto;margin-top:10px}
      .tile{border:1px solid var(--border);border-radius:12px;padding:10px;background:#fff;cursor:pointer}
      .tile.active{border-color:#99f6e4;box-shadow:inset 0 0 0 2px rgba(16,185,129,.15)}
      .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
      .field{display:grid;gap:6px}
      .field label{font-size:12px;color:var(--muted);font-weight:700}
      .field input,.field textarea,.field select{border:1px solid var(--border);border-radius:10px;padding:8px 10px;font:inherit;width:100%}
      .field textarea{min-height:120px;resize:vertical}
      .toolbar{display:flex;gap:8px;flex-wrap:wrap}
      .chips{display:flex;gap:6px;flex-wrap:wrap}
      .chip{background:#ecfeff;color:#0e7490;border:1px solid #bae6fd;padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700}
      .chip.muted{opacity:.7}
      .tile-title{font-weight:700}
      .tile-sub{color:var(--muted);font-size:12px}
      /* Category colors row */
      .cat-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fafafa}
      .cat-label{font-weight:700;color:#334155}
      .cat-controls{display:flex;align-items:center;gap:10px}
      .cat-preview{width:34px;height:24px;border-radius:6px;display:grid;place-items:center;font-weight:800;font-size:11px}
      .cat-color{width:60px;height:36px;border:1px solid var(--border);border-radius:6px;cursor:pointer}
      .notice{display:none;position:fixed;top:10px;right:10px;background:#111827;color:#fff;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.1);font-weight:700;z-index:1000}
  .hidden{display:none!important}
  /* Highlight assist */
  .ea-highlight-pulse{outline:3px solid #0ea5e9!important;animation:eaPulse 1.2s linear infinite;border-radius:8px}
  @keyframes eaPulse{0%,100%{outline-color:#0ea5e9}50%{outline-color:#fbbf24}}
  /* Variables editor */
  .vars-editor{margin-top:8px;border-top:1px dashed var(--border);padding-top:10px}
  .vgrid{display:grid;grid-template-columns: minmax(140px, 240px) 1fr 1fr minmax(130px, 180px) minmax(130px, 180px);gap:8px;align-items:start}
  .vrow{display:contents}
  .vkey{font-weight:700;padding:6px 8px;background:#f1f5f9;border:1px solid var(--border);border-radius:8px;color:#334155}
  .vinput{border:1px solid var(--border);border-radius:10px;padding:8px 10px;font:inherit;width:100%}
  .vhead{font-size:12px;color:var(--muted);font-weight:700}
  @media (max-width: 900px){ .vgrid{grid-template-columns:1fr} .vkey{margin-bottom:2px} }
      @media (max-width: 1000px){ .frame{grid-template-columns:1fr} .row{grid-template-columns:1fr} }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div class="brand">Admin (simple) <span id="updated-badge" title="Dernière mise à jour distante du JSON">–</span>
        <select id="import-mode" title="Mode d'import">
          <option value="merge">Fusionner</option>
          <option value="replace">Remplacer</option>
        </select>
      </div>
      <div class="spacer"></div>
      <div class="group">
        <button class="btn info" id="btn-import">Importer</button>
        <input id="file" type="file" class="hidden" accept=".json,application/json,.xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
        <button class="btn neutral" id="btn-dl-template-xlsx" title="Télécharger un modèle Excel (.xlsx) avec les colonnes requises">Modèle XLSX</button>
      </div>
      <div class="group">
        <button class="btn indigo" id="btn-export-xlsx" title="Exporter toutes les données courantes en Excel (.xlsx)">Exporter Excel</button>
        <span class="dropdown">
          <button class="btn primary" id="btn-export-menu">Publier</button>
          <div id="export-menu" class="menu">
            <button id="act-export-download" class="item">Télécharger JSON</button>
            <button id="act-export-github" class="item">Publier sur GitHub</button>
            <button id="act-export-config" class="item">Configurer GitHub…</button>
          </div>
        </span>
      </div>
      <div class="group">
        <button class="btn warning" id="btn-category-colors" title="Gérer les couleurs des catégories">Catégories</button>
      </div>
      <div class="group">
        <button class="btn danger" id="btn-reset">Réinitialiser</button>
        <button class="btn neutral" id="btn-help">Aide</button>
      </div>
    </div>

    <div id="notice" class="notice"></div>

    <!-- Category Colors Modal -->
    <div id="modal-category-colors">
      <div class="modal-panel">
        <div class="modal-header">
          <strong>Couleurs des catégories</strong>
          <button onclick="document.getElementById('modal-category-colors').style.display='none'" class="modal-close">×</button>
        </div>
        <div id="category-colors-body" class="modal-body">
          <p class="modal-note">Définir une couleur indicatrice pour chaque catégorie (affichée dans le sélecteur de modèles).</p>
          <div id="category-colors-list"></div>
        </div>
        <div class="modal-footer">
          <button class="btn" onclick="document.getElementById('modal-category-colors').style.display='none'">Fermer</button>
          <button class="btn primary" id="btn-save-category-colors">Enregistrer</button>
        </div>
      </div>
    </div>

    <div class="frame">
      <aside class="panel">
        <div class="head"><strong>Modèles</strong><button class="btn" id="btn-new">Ajouter un modèle</button></div>
        <div class="body">
          <div class="search"><input id="search" placeholder="Rechercher…" /></div>
          <div id="list" class="list"></div>
        </div>
      </aside>

      <main class="panel">
        <div class="head"><strong id="hdr">Éditeur</strong>
          <div class="toolbar">
            <button class="btn" id="btn-delete">Supprimer</button>
          </div>
        </div>
        <div class="body" id="editor">
          <div class="row">
            <div class="field span-2"><label>ID</label><input id="tpl-id" placeholder="ex: welcome_email" title="Identifiant unique (lettres, chiffres, underscore)" /></div>
          </div>
          <div class="row">
            <div class="field"><label>Catégorie (FR)</label><input id="tpl-cat-fr" placeholder="ex: Service client" title="Catégorie en français" /></div>
            <div class="field"><label>Category (EN)</label><input id="tpl-cat-en" placeholder="ex: Customer Care" title="Category in English" /></div>
          </div>
          <div class="row">
            <div class="field"><label>Titre (FR)</label><input id="tpl-title-fr" placeholder="ex: Bienvenue – Nouveau client" title="Titre en français" /></div>
            <div class="field"><label>Titre (EN)</label><input id="tpl-title-en" placeholder="ex: Welcome – New customer" title="Title in English" /></div>
          </div>
          <div class="row">
            <div class="field"><label>Description (FR)</label><input id="tpl-desc-fr" placeholder="ex: Courriel de bienvenue pour un nouveau client" title="Description en français" /></div>
            <div class="field"><label>Description (EN)</label><input id="tpl-desc-en" placeholder="ex: Welcome email for a new customer" title="Description in English" /></div>
          </div>
          <div class="row">
            <div class="field"><label>Objet (FR)</label><input id="tpl-subj-fr" placeholder="ex: Bienvenue chez ECHO !" title="Objet en français" /></div>
            <div class="field"><label>Objet (EN)</label><input id="tpl-subj-en" placeholder="ex: Welcome to ECHO!" title="Subject in English" /></div>
          </div>
          <div class="row">
            <div class="field"><label>Corps (FR)</label><textarea id="tpl-body-fr" placeholder="Bonjour <<nom_client>>,\n\nMerci pour votre confiance…" title="Corps du message (FR)"></textarea></div>
            <div class="field"><label>Corps (EN)</label><textarea id="tpl-body-en" placeholder="Hello <<customer_name>>,\n\nThank you for your trust…" title="Body (EN)"></textarea></div>
          </div>
          <div class="field">
            <label>Variables détectées (automatique)</label>
            <button class="btn" id="btn-sync-vars" title="Synchroniser la liste des variables avec le texte">Sync variables</button>
            <div id="vars" class="chips"></div>
            <div id="vars-editor" class="vars-editor"></div>
          </div>
        </div>
      </main>
    </div>

    <script src="./assets/admin-simple.js?v=1763917928161"></script>
    <script>
      // Lightweight badge population: fetch raw main JSON headers quickly
      (async function(){
        try {
          const repo = document.querySelector('meta[name="gh-repo"]')?.content || 'snarky1980/echo-bt-ctd';
          const url = `https://raw.githubusercontent.com/${repo}/main/complete_email_templates.json`;
          const resp = await fetch(url, { cache:'no-store' });
          if(!resp.ok) return;
          const text = await resp.text();
          const json = JSON.parse(text);
          const ts = json?.metadata?.updatedAt || json?.metadata?.generatedAt || null;
          if(ts){
            const badge = document.getElementById('updated-badge');
            badge.textContent = new Date(ts).toLocaleString('fr-FR',{ hour12:false });
            badge.style.display = 'inline-block';
          }
        } catch(e){ /* silent */ }
      })();
    </script>
  </body>
  </html>
